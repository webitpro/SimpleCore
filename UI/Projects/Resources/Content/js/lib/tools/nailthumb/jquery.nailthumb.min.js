(function(a){var d=false;
var E="1.1";
a.fn.nailthumb=function(F){var G=a.extend({},a.fn.nailthumb.defaults,F);
return this.each(function(){var H=a(this);
var I=a.metadata?a.extend({},G,H.metadata()):G;
D(H,I)
})
};
function D(G,I){var H=B(G,I);
var F=A(G,I);
if(I.serverSideParams){a.fn.nailthumb.setServerSideParams(H,F,I)
}e("image",H);
e("container",F);
if(I.onStart){I.onStart(F,I)
}if(I.loadingClass){F.addClass(I.loadingClass)
}if(I.preload||H.data("nailthumb.replaceto")){c("wait on load");
H.one("load",function(){e("before check",H);
if(!H.data("nailthumb.working")&&!H.data("nailthumb.replacing")){H.data("nailthumb.working",true);
e("inside check",H);
g(H,F,I)
}});
var J=H.attr("src");
H.attr("src",null).attr("src",J)
}else{c("nail thumb directly");
H.data("nailthumb.working",true);
g(H,F,I)
}}function g(H,F,J){v(H,J);
u(F,J);
var I=o(H,J);
e("image",H);
e("imageDims",I);
if(I.width==0||I.height==0){I=m(H);
e("imageCloneDims",I)
}var G=i(F,J);
e("container",F);
e("containerDims",G);
var K=p(G,I,J);
c("proportions",K);
x(H,I,F,G,K,J)
}function B(F,J){var H=F.find("img").first();
var G=J.imageCustomFinder;
if(!G&&J.imageUrl){G=r
}else{if(!G&&J.imageFromWrappingLink){G=q
}}if(G){var I=G(F,J);
e("finder",I);
if(!I){I=[]
}if(I.length>0){H=I;
H.css("display","none");
if(!H.data("nailthumb.replaceto")){H.data("nailthumb.replaceto",F)
}H.data("nailthumb.originalImageDims",null)
}}if(H.length==0){if(F.is("img")){H=F
}}return H
}function r(F,H){var G=a("<img />").attr("src",H.imageUrl).css("display","none").data("nailthumb.replaceto",F);
F.append(G);
return G
}function q(F,I){var G;
var H=F.find("a").first();
if(H.length==0&&F.is("a")){H=F
}if(H.attr("href")){G=a("<img />").attr("src",H.attr("href")).css("display","none").data("nailthumb.replaceto",H);
if(H.attr("title")){G.attr("title",H.attr("title"))
}H.append(G)
}return G
}function v(F,G){if(!G.nostyle){F.css({position:"relative"})
}if(!F.data("nailthumb.originalImageDims")){F.css({width:"auto",height:"auto",top:0,left:0}).removeAttr("width").removeAttr("height")
}}function A(H,I){var G=H;
if(H.is("img")){if(I.ifImageAddContainer){var F=a("<div></div>");
H.wrap(F)
}G=H.parent()
}return G
}function u(F,G){if(G.containerClass){F.addClass(G.containerClass)
}if(!G.nostyle){F.css({overflow:"hidden",padding:"0px"})
}if(G.replaceAnimation=="animate"){if(G.width||G.height){F.animate({width:G.width,height:G.height},G.animationTime,G.animation)
}}else{if(G.width){F.width(G.width)
}if(G.height){F.height(G.height)
}}F.find("span."+G.titleClass).remove()
}function x(K,L,F,G,P,O){var M=L.width*P;
var J=L.height*P;
var Q=0,N=0,H;
var I=l(O.fitDirection);
if(J<G.innerHeight){switch(I.v){case"center":Q=-(J-G.innerHeight)/2;
break;
case"bottom":Q=-(J-G.innerHeight);
H="bottom";
break;
case"top":Q=0;
H="top";
break;
default:break
}}else{if(J>G.innerHeight){switch(I.v){case"center":Q=-(J-G.innerHeight)/2;
break;
case"bottom":Q=-(J-G.innerHeight);
break;
default:break
}}}if(M<G.innerWidth){switch(I.h){case"center":N=-(M-G.innerWidth)/2;
break;
case"right":N=-(M-G.innerWidth);
break;
default:break
}}else{if(M>G.innerWidth){switch(I.h){case"center":N=-(M-G.innerWidth)/2;
break;
case"right":N=-(M-G.innerWidth);
break;
default:break
}}}K.addClass(O.imageClass);
if(K.data("nailthumb.replaceto")){t(K,L,F,G,J,M,N,Q,H,O)
}else{C(K,L,F,G,J,M,N,Q,H,O)
}}function t(K,L,F,G,J,M,N,Q,H,O){var I=K.data("nailthumb.replaceto");
var P=h(I,O);
K.data("nailthumb.replacing",true);
K.load(function(){K.data("nailthumb.replacing",null)
});
if(P){P.replaceWith(K)
}else{I.append(K)
}if(O.afterReplace){O.afterReplace(F,K,O)
}C(K,L,F,G,J,M,N,Q,H,O)
}function C(J,K,F,G,I,L,M,O,H,N){if(N.replaceAnimation=="animate"){J.css("display","inline");
F.animate({width:G.innerWidth,height:G.innerHeight},N.animationTime,N.animation);
J.animate({width:L,height:I,top:O,left:M},N.animationTime,N.animation,function(){b(J,K,F,G,I,L,M,O,H,N)
})
}else{F.css({width:G.innerWidth,height:G.innerHeight});
if(N.replaceAnimation){J.css("display","none")
}J.css({width:L,height:I,top:O,left:M});
if(N.replaceAnimation=="fade"){J.fadeIn(N.animationTime,N.animation,function(){b(J,K,F,G,I,L,M,O,H,N)
})
}else{if(N.replaceAnimation=="slide"){J.slideDown(N.animationTime,N.animation,function(){b(J,K,F,G,I,L,M,O,H,N)
})
}else{if(N.replaceAnimation&&N.replaceAnimation instanceof Function){N.replaceAnimation(J,function(){b(J,K,F,G,I,L,M,O,H,N)
},N);
if(!N.selfStartAfterAppear){b(J,K,F,G,I,L,M,O,H,N)
}}else{J.css("display","inline");
b(J,K,F,G,I,L,M,O,H,N)
}}}}}function b(J,K,F,G,I,L,M,O,H,N){if(N.afterAppear){N.afterAppear(F,J,N)
}J.data("nailthumb.replaceto",null);
f(J,K,F,G,I,L,M,O,H,N)
}function h(F,G){var H=null;
F.find("img").each(function(){if(!H&&!a(this).data("nailthumb.replaceto")){H=a(this)
}});
return H
}function f(N,O,H,I,L,P,Q,W,K,R){if(R.title||(R.titleAttr&&N.attr(R.titleAttr))){var V=R.title?R.title:N.attr(R.titleAttr);
if(V){var T=a('<span class="'+R.titleClass+'">'+V+"</span>");
if(I.innerHeight>L){T.css("top",I.innerHeight-L)
}else{T.css("top","0px")
}H.append(T);
var U=n(T);
var M=n(N);
e("decorate containerDims",I);
e("decorate imageDims",O);
e("decorate imageDims",M);
e("decorate tit",U);
var S=I.offsetTop+I.innerHeight-U.offsetTop;
if(I.height>I.innerHeight){S+=(I.height-I.innerHeight)/2
}T.css("top","+="+S);
if(P<U.width){T.css("width",P)
}if(Q>0){T.css("left",Q)
}var J=U.height;
if(I.innerHeight>L&&K!="bottom"){J+=(I.innerHeight-L)/((K=="top")?1:2)
}var F=T.clone();
F.css("width","auto").css("display","none").css("position","absolute");
H.append(F);
var G=n(F);
F.remove();
e("decorate cloneDims",G);
if(R.titleWhen=="hover"){H.unbind("mouseenter mouseleave").hover(function(){T.find("span."+R.titleScrollerClass).css("left",0);
I=n(H);
U=n(T);
S=I.offsetTop+I.innerHeight-U.offsetTop;
if(I.height>I.innerHeight){S+=(I.height-I.innerHeight)/2
}e("decorate hover tit",U);
c("decorate hover outbound",U);
var X=0;
if(S<0){T.css("top","+="+S);
X=J
}else{X=J-S
}if(R.animateTitle){w(T,R);
T.stop(true).animate({top:"-="+X},R.titleAnimationTime,R.titleAnimation,function(){z(T,G.width,I.innerWidth,R)
})
}else{T.css({top:"-="+X});
z(T,G.width,I.innerWidth,R)
}},function(){if(R.animateTitle){w(T,R);
T.animate({top:"+="+J},R.titleAnimationTime,R.titleAnimation,function(){w(T,R)
})
}else{w(T,R);
T.css({top:"+="+J})
}})
}else{if(R.animateTitle){T.animate({top:"-="+J},R.titleAnimationTime,R.titleAnimation,function(){z(T,G.width,I.innerWidth,R)
})
}else{T.css({top:"-="+J});
z(T,G.width,I.innerWidth,R)
}}}}if(R.onFinish){R.onFinish(H,R)
}if(R.loadingClass){H.removeClass(R.loadingClass)
}N.data("nailthumb.working",null)
}function w(G,F){G.find("span."+F.titleScrollerClass).stop()
}function z(G,I,H,F){if(I>H&&F.titleScrolling){if(G.find("span."+F.titleScrollerClass).length==0){G.wrapInner('<span class="'+F.titleScrollerClass+'" />');
G.find("span."+F.titleScrollerClass).width(I).css("position","relative").css("white-space","nowrap")
}G.find("span."+F.titleScrollerClass).css("left",0);
setTimeout(y(G,I,H,F),1000)
}}function y(G,I,H,F){return function(){var K=Number(G.find("span."+F.titleScrollerClass).css("left").replace(/[^-\d]/g,""));
c("indent",K);
c("width",I);
c("visibleWidth",H);
c("width <= -indent",(I<=-K));
var J=I+K;
if(J<=0){G.find("span."+F.titleScrollerClass).css("left",H);
J=I+H
}J+=10;
G.find("span."+F.titleScrollerClass).animate({left:"-="+J},I*1000/30,"linear",y(G,I,H,F))
}
}function p(F,G,H){if(H.proportions!=null&&H.proportions>0){return H.proportions
}else{var I=F.innerWidth/G.width;
if(H.method&&H.method=="resize"){if(F.innerHeight/G.height<I){I=F.innerHeight/G.height
}}else{if(F.innerHeight/G.height>I){I=F.innerHeight/G.height
}}if(H.maxEnlargement&&H.maxEnlargement<I){I=H.maxEnlargement
}if(H.maxShrink&&H.maxShrink>I){I=H.maxShrink
}return I
}}function l(G){var F={h:"center",v:"center"};
if(G){var H=G.split(" ");
if(H.length>0){F=k(H[0],F)
}if(H.length>1){F=k(H[1],F)
}}return F
}function k(G,F){switch(G){case"top":F.v="top";
break;
case"bottom":F.v="bottom";
break;
case"left":F.h="left";
break;
case"right":F.h="right";
break;
default:break
}return F
}function o(F,H){var G;
if(!F.data("nailthumb.originalImageDims")){G=n(F);
F.data("nailthumb.originalImageDims",G);
if(!H.keepImageDimensions){F.one("load",function(){F.data("nailthumb.originalImageDims",null)
})
}}else{G=F.data("nailthumb.originalImageDims")
}return G
}function i(F,H){var G=n(F);
if(H.width){G.innerWidth=H.width
}if(H.height){G.innerHeight=H.height
}return G
}function j(F){var G=a(F).offset();
return{offsetTop:G.top,offsetLeft:G.left,width:a(F).outerWidth(),height:a(F).outerHeight(),innerWidth:a(F).innerWidth(),innerHeight:a(F).innerHeight()}
}function n(I){var G=null,K=0,L,H;
while((H=I[K++])){var J=a(H).parents().andSelf().filter(":hidden");
if(!J.length){G=j(H)
}else{var F=[];
J.each(function(){var M=a(this).attr("style");
M=typeof M=="undefined"?"":M;
F.push(M);
a(this).attr("style",M+" display: block !important;")
});
J.eq(0).css("left",-10000);
G=j(H);
J.each(function(){a(this).attr("style",F.shift())
})
}}return G
}function m(J){var H=null,L=0,M,I;
while((I=J[L++])){var K=a(I).parents().andSelf().filter(":hidden");
if(!K.length){H=j(I)
}else{var F=[];
K.each(function(){var N=a(this).attr("style");
N=typeof N=="undefined"?"":N;
F.push(N);
a(this).attr("style",N+" display: block !important;")
});
K.eq(0).css("left",-10000);
var G=K.eq(0).clone();
a("body").append(G);
H=j(G);
K.each(function(){a(this).attr("style",F.shift())
});
G.remove()
}}return H
}a.fn.nailthumb.evalServerSideParams=function(I,F,J){if(J.serverSideParams){var K={};
if(!J.serverSideParams.noServerResize){var M=null,H=null;
if(J.serverSideParams.width){M=J.serverSideParams.width
}else{if(J.width){M=J.width
}}if(J.serverSideParams.height){H=J.serverSideParams.height
}else{if(J.height){H=J.height
}}if(!(M&&H)){u(F,J);
var G=i(F,J);
M=G.innerWidth;
H=G.innerHeight
}if(M&&H){K.w=M;
K.h=H;
if(J.serverSideParams.mode!="resize"){if(J.method=="crop"){K.mode="crop"
}if(J.serverSideParams.mode){K.mode=J.serverSideParams.mode
}}}}a.each(J.serverSideParams,function(N,O){if(N!="width"&&N!="height"&&N!="mode"&&N!="noServerResize"&&O){K[N]=O
}});
var L="";
a.each(K,function(N,O){L+=";"+N+"="+O
});
c(L,K);
return L
}else{return""
}};
a.fn.nailthumb.setServerSideParams=function(G,F,H){if(H.serverSideParams){var J=G.attr("src");
if(G.data("nailthumb.originalImageUrl")){J=G.data("nailthumb.originalImageUrl")
}G.data("nailthumb.originalImageUrl",J);
var I=a.fn.nailthumb.evalServerSideParams(G,F,H);
J+=I;
G.attr("src",J)
}};
a.fn.nailthumb.toggleDebug=function(){d=!d
};
a.fn.nailthumb.doThumb=function(G,F,H){g(G,F,H)
};
a.fn.nailthumb.defaults={onStart:null,onFinish:null,loadingClass:"nailthumb-loading",imageUrl:null,imageFromWrappingLink:false,imageCustomFinder:null,imageClass:"nailthumb-image",afterReplace:null,afterAppear:null,replaceAnimation:"fade",selfStartAfterAppear:false,animationTime:1000,animation:"swing",keepImageDimensions:false,method:"crop",fitDirection:null,proportions:null,ifImageAddContainer:true,containerClass:"nailthumb-container",maxEnlargement:null,maxShrink:null,preload:true,nostyle:false,width:null,height:null,title:null,titleClass:"nailthumb-title",titleAttr:"title",titleWhen:"hover",titleScrolling:true,titleScrollerClass:"nailthumb-title-scroller",animateTitle:true,titleAnimationTime:500,titleAnimation:"swing",serverSideParams:null};
function s(H,G){try{c(H,G,true)
}catch(F){}}function c(I,H,G){try{if((d&&window.console&&window.console.log)||G){window.console.log(I+": "+H)
}}catch(F){}}function e(I,H,G){try{if(!H){H=I
}c(I,H);
if((d&&window.console&&window.console.log)||G){window.console.debug(H)
}}catch(F){}}})(jQuery);