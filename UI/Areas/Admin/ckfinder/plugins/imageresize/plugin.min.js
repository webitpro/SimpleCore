CKFinder.addPlugin("imageresize",{readOnly:false,connectorInitialized:function(a,c){var b=c.selectSingleNode("Connector/PluginsInfo/imageresize/@smallThumb");
if(b){CKFinder.config.imageresize_thumbSmall=b.value
}b=c.selectSingleNode("Connector/PluginsInfo/imageresize/@mediumThumb");
if(b){CKFinder.config.imageresize_thumbMedium=b.value
}b=c.selectSingleNode("Connector/PluginsInfo/imageresize/@largeThumb");
if(b){CKFinder.config.imageresize_thumbLarge=b.value
}},uiReady:function(a){var f=/^(.*)\.([^\.]+)$/,g=/^(.*?)(?:_\d+x\d+)?\.([^\.]+)$/,h=/^\s*(\d+)(px)?\s*$/i,i=/(^\s*(\d+)(px)?\s*$)|^$/i,d={width:0,height:0},c,b;
var l=function(m){var q=m.getValueOf("tab1","width")||0,o=m.getValueOf("tab1","height")||0,n=m.getContentElement("tab1","createNewBox");
if(q&&o){var p=c.name.match(g);
m.setValueOf("tab1","fileName",p[1]+"_"+q+"x"+o);
n.getElement().show()
}else{n.getElement().hide()
}};
var e=function(){var t=this.getValue(),n=this.getDialog(),q=a.config.imagesMaxWidth,p=a.config.imagesMaxHeight,m=t.match(h),u=d.width,o=d.height,r,s;
if(m){t=m[1]
}if(!a.config.imageresize_allowEnlarging){if(u&&u<q){q=u
}if(o&&o<p){p=o
}}if(p>0&&this.id=="height"&&t>p){t=p;
n.setValueOf("tab1","height",t)
}if(q>0&&this.id=="width"&&t>q){t=q;
n.setValueOf("tab1","width",t)
}if(n.lockRatio&&u&&o){if(this.id=="height"){if(t&&t!="0"){t=Math.round(u*(t/o))
}if(!isNaN(t)){if(q>0&&t>q){t=q;
r=Math.round(o*(t/u));
n.setValueOf("tab1","height",r)
}n.setValueOf("tab1","width",t)
}}else{if(t&&t!="0"){t=Math.round(o*(t/u))
}if(!isNaN(t)){if(p>0&&t>p){t=p;
s=Math.round(u*(t/o));
n.setValueOf("tab1","width",s)
}n.setValueOf("tab1","height",t)
}}}l(n)
};
var j=function(m){if(d.width&&d.height){m.setValueOf("tab1","width",d.width);
m.setValueOf("tab1","height",d.height);
l(m)
}};
var k=function(m,s){var n=m.getElement().getDocument(),q=n.getById("btnLockSizes");
if(d.width&&d.height){if(s=="check"){var t=m.getValueOf("tab1","width"),o=m.getValueOf("tab1","height"),p=d.width*1000/d.height,r=t*1000/o;
m.lockRatio=false;
if(!t&&!o){m.lockRatio=true
}else{if(!isNaN(p)&&!isNaN(r)){if(Math.round(p)==Math.round(r)){m.lockRatio=true
}}}}else{if(s!=undefined){m.lockRatio=s
}else{m.lockRatio=!m.lockRatio
}}}else{if(s!="check"){m.lockRatio=false
}}if(m.lockRatio){q.removeClass("ckf_btn_unlocked")
}else{q.addClass("ckf_btn_unlocked")
}return m.lockRatio
};
CKFinder.dialog.add("resizeDialog",function(m){return{title:m.lang.Imageresize.dialogTitle.replace("%s",m.getSelectedFile().name),minWidth:CKFinder.env.webkit?290:390,minHeight:230,onShow:function(){var n=this,s=CKFinder.config.imageresize_thumbSmall,r=CKFinder.config.imageresize_thumbMedium,q=CKFinder.config.imageresize_thumbLarge;
b=n.getElement().getDocument();
c=m.getSelectedFile();
this.setTitle(m.lang.Imageresize.dialogTitle.replace("%s",c.name));
var o=b.getById("previewImage");
var p=b.getById("imageSize");
o.setAttribute("src",c.getThumbnailUrl(true));
o.on("load",function(){o.removeStyle("width");
o.removeStyle("height");
var v=o.$.width,u=o.$.height;
o.hide();
if(CKFinder.env.ie6Compat){if(v>u){o.setStyles({width:100+"px",height:Math.round(u/(v/100))+"px"})
}else{o.setStyles({height:100+"px",width:Math.round(v/(u/100))+"px"})
}}else{o.removeStyle("max-width");
o.removeStyle("max-height");
if(v>u){o.setStyle("max-width","100px")
}else{o.setStyle("max-height","100px")
}}o.show()
});
var t=function(v,u){if(!v||!u){p.setText("");
return
}d.width=v;
d.height=u;
p.setText(v+" x "+u+" px");
CKFinder.tools.setTimeout(function(){k(n,"check")
},0,n)
};
m.connector.sendCommand("ImageResizeInfo",{fileName:c.name},function(y){if(y.checkError()){return
}var x=y.selectSingleNode("Connector/ImageInfo/@width"),v=y.selectSingleNode("Connector/ImageInfo/@height"),w;
if(x&&v){x=parseInt(x.value,10);
v=parseInt(v.value,10);
t(x,v);
var u=function(A,C){if(!C){return
}var B=/^(\d+)x(\d+)$/;
w=B.exec(C);
var z=n.getContentElement("tab1",A);
if(0+w[1]>x&&0+w[2]>v){z.disable();
z.getElement().setAttribute("title",m.lang.Imageresize.imageSmall).addClass("cke_disabled")
}else{z.enable();
z.getElement().setAttribute("title","").removeClass("cke_disabled")
}};
u("smallThumb",s);
u("mediumThumb",r);
u("largeThumb",q)
}},c.folder.type,c.folder);
if(!s){n.getContentElement("tab1","smallThumb").getElement().hide()
}if(!r){n.getContentElement("tab1","mediumThumb").getElement().hide()
}if(!q){n.getContentElement("tab1","largeThumb").getElement().hide()
}if(!s&&!r&&!q){n.getContentElement("tab1","thumbsLabel").getElement().hide()
}n.setValueOf("tab1","fileName",c.name);
n.getContentElement("tab1","fileNameExt").getElement().setHtml("."+c.ext);
n.getContentElement("tab1","width").focus();
n.getContentElement("tab1","fileName").setValue("");
n.getContentElement("tab1","createNewBox").getElement().hide();
t(0,0)
},onOk:function(){var o=this,v=o.getValueOf("tab1","width"),q=o.getValueOf("tab1","height"),t=o.getValueOf("tab1","smallThumb"),s=o.getValueOf("tab1","mediumThumb"),r=o.getValueOf("tab1","largeThumb"),p=o.getValueOf("tab1","fileName"),n=o.getValueOf("tab1","createNew");
if(v&&!q){m.openMsgDialog("",m.lang.Imageresize.invalidHeight);
return false
}else{if(!v&&q){m.openMsgDialog("",m.lang.Imageresize.invalidWidth);
return false
}}if(!m.config.imageresize_allowEnlarging&&(parseInt(v,10)>d.width||parseInt(q,10)>d.height)){var u=m.lang.Imageresize.sizeTooBig;
m.openMsgDialog("",u.replace("%size",d.width+"x"+d.height));
return false
}if((v&&q)||t||s||r){if(!n){p=c.name
}m.connector.sendCommandPost("ImageResize",null,{width:v,height:q,fileName:c.name,newFileName:p+"."+c.ext,overwrite:n?0:1,small:t?1:0,medium:s?1:0,large:r?1:0},function(w){if(w.checkError()){return
}m.openMsgDialog("",m.lang.Imageresize.resizeSuccess);
m.refreshOpenedFolder()
},c.folder.type,c.folder)
}return undefined
},contents:[{id:"tab1",label:"",title:"",expand:true,padding:0,elements:[{type:"hbox",widths:[(CKFinder.env.webkit?130:180)+"px",(CKFinder.env.webkit?250:280)+"px"],children:[{type:"vbox",children:[{type:"html",html:'<style type="text/css">a.ckf_btn_reset{float: right;background-position: 0 -32px;background-image: url("'+CKFinder.getPluginPath("imageresize")+'images/mini.gif");width: 16px;height: 16px;background-repeat: no-repeat;border: 1px none;font-size: 1px;}a.ckf_btn_locked,a.ckf_btn_unlocked{float: left;background-position: 0 0;background-image: url("'+CKFinder.getPluginPath("imageresize")+'images/mini.gif");width: 16px;height: 16px;background-repeat: no-repeat;border: none 1px;font-size: 1px;}a.ckf_btn_unlocked{background-position: 0 -16px;background-image: url("'+CKFinder.getPluginPath("imageresize")+'/images/mini.gif");}.ckf_btn_over{border: outset 1px;cursor: pointer;cursor: hand;}</style><div style="height:110px;padding:7px"><img id="previewImage" src="" style="margin-bottom:4px; max-width: 100px; max-height: 100px;" /><br /><span style="font-size:9px;" id="imageSize"></span></div>'},{type:"html",id:"thumbsLabel",html:"<strong>"+m.lang.Imageresize.thumbnailNew+"</strong>"},{type:"checkbox",id:"smallThumb",checked:false,label:m.lang.Imageresize.thumbnailSmall.replace("%s",CKFinder.config.imageresize_thumbSmall)},{type:"checkbox",id:"mediumThumb",checked:false,label:m.lang.Imageresize.thumbnailMedium.replace("%s",CKFinder.config.imageresize_thumbMedium)},{type:"checkbox",id:"largeThumb",checked:false,label:m.lang.Imageresize.thumbnailLarge.replace("%s",CKFinder.config.imageresize_thumbLarge)}]},{type:"vbox",children:[{type:"html",html:"<strong>"+m.lang.Imageresize.newSize+"</strong>"},{type:"hbox",widths:["80%","20%"],children:[{type:"vbox",children:[{type:"text",labelLayout:"horizontal",label:m.lang.Imageresize.width,onKeyUp:e,validate:function(){var o=this.getValue();
if(o){var n=o.match(h);
if(!n||parseInt(n[1],10)<1){m.openMsgDialog("",m.lang.Imageresize.invalidWidth);
return false
}}return true
},id:"width"},{type:"text",labelLayout:"horizontal",label:m.lang.Imageresize.height,onKeyUp:e,validate:function(){var o=this.getValue();
if(o){var n=o.match(h);
if(!n||parseInt(n[1],10)<1){m.openMsgDialog("",m.lang.Imageresize.invalidHeight);
return false
}}return true
},id:"height"}]},{type:"html",onLoad:function(){var o=this.getElement().getDocument(),n=this.getDialog();
var q=o.getById("btnResetSize"),p=o.getById("btnLockSizes");
if(q){q.on("click",function(r){j(this);
r.data.preventDefault()
},n);
q.on("mouseover",function(){this.addClass("ckf_btn_over")
},q);
q.on("mouseout",function(){this.removeClass("ckf_btn_over")
},q)
}if(p){p.on("click",function(r){var t=k(this),u=this.getValueOf("tab1","width");
if(d.width&&u){var s=d.height/d.width*u;
if(!isNaN(s)){this.setValueOf("tab1","height",Math.round(s));
l(n)
}}r.data.preventDefault()
},n);
p.on("mouseover",function(){this.addClass("ckf_btn_over")
},p);
p.on("mouseout",function(){this.removeClass("ckf_btn_over")
},p)
}},html:'<div style="margin-top:4px"><a href="javascript:void(0)" tabindex="-1" title="'+m.lang.Imageresize.lockRatio+'" class="ckf_btn_locked ckf_btn_unlocked" id="btnLockSizes"></a><a href="javascript:void(0)" tabindex="-1" title="'+m.lang.Imageresize.resetSize+'" class="ckf_btn_reset" id="btnResetSize"></a></div>'}]},{type:"vbox",id:"createNewBox",hidden:true,children:[{type:"checkbox",checked:true,id:"createNew",label:m.lang.Imageresize.newImage,"default":true,onChange:function(){var n=this.getDialog();
var o=n.getContentElement("tab1","fileName");
if(o){if(!this.getValue()){o.getElement().hide()
}else{o.getElement().show()
}}}},{type:"hbox",widths:["90%","10%"],padding:0,children:[{type:"text",label:"",validate:function(){var o=this.getDialog(),n=o.getContentElement("tab1","createNew"),p=this.getValue();
if(n&&o.getValueOf("tab1","width")&&o.getValueOf("tab1","height")){if(!p){m.openMsgDialog("",m.lang.Imageresize.invalidName);
return false
}}return true
},id:"fileName"},{type:"html",html:"",id:"fileNameExt",onLoad:function(){this.getElement().getParent().setStyles({"vertical-align":"bottom","padding-bottom":"2px"})
}}]}]}]}]}]}],buttons:[CKFinder.dialog.okButton,CKFinder.dialog.cancelButton]}
});
a.addFileContextMenuOption({label:a.lang.Imageresize.contextMenuName,command:"resizeImage"},function(m,n){m.openDialog("resizeDialog")
},function(m){if(!m.isImage()||!a.getSelectedFolder().type){return false
}if(m.folder.acl.fileDelete&&m.folder.acl.fileUpload){return true
}else{return -1
}})
}});