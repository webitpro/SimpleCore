(function(){CKEDITOR.config.jqueryOverrideVal=typeof CKEDITOR.config.jqueryOverrideVal=="undefined"?true:CKEDITOR.config.jqueryOverrideVal;var jQuery=window.jQuery;if(typeof jQuery=="undefined")return;jQuery.extend(jQuery.fn,{ckeditorGet:function(){var instance=this.eq(0).data("ckeditorInstance");if(!instance)throw"CKEditor not yet initialized, use ckeditor() with callback.";return instance},ckeditor:function(callback,config){if(!CKEDITOR.env.isCompatible)return this;if(!jQuery.isFunction(callback)){var tmp=
config;config=callback;callback=tmp}config=config||{};this.filter("textarea, div, p").each(function(){var $element=jQuery(this),editor=$element.data("ckeditorInstance"),instanceLock=$element.data("_ckeditorInstanceLock"),element=this;if(editor&&!instanceLock){if(callback)callback.apply(editor,[this])}else if(!instanceLock){if(config.autoUpdateElement||typeof config.autoUpdateElement=="undefined"&&CKEDITOR.config.autoUpdateElement)config.autoUpdateElementJquery=true;config.autoUpdateElement=false;
$element.data("_ckeditorInstanceLock",true);editor=CKEDITOR.replace(element,config);$element.data("ckeditorInstance",editor);editor.on("instanceReady",function(event){var editor=event.editor;setTimeout(function(){if(!editor.element){setTimeout(arguments.callee,100);return}event.removeListener("instanceReady",this.callee);editor.on("dataReady",function(){$element.trigger("setData"+".ckeditor",[editor])});editor.on("getData",function(event){$element.trigger("getData"+".ckeditor",[editor,event.data])},
999);editor.on("destroy",function(){$element.trigger("destroy.ckeditor",[editor])});if(editor.config.autoUpdateElementJquery&&$element.is("textarea")&&$element.parents("form").length){var onSubmit=function(){$element.ckeditor(function(){editor.updateElement()})};$element.parents("form").submit(onSubmit);$element.parents("form").bind("form-pre-serialize",onSubmit);$element.bind("destroy.ckeditor",function(){$element.parents("form").unbind("submit",onSubmit);$element.parents("form").unbind("form-pre-serialize",
onSubmit)})}editor.on("destroy",function(){$element.data("ckeditorInstance",null)});$element.data("_ckeditorInstanceLock",null);$element.trigger("instanceReady.ckeditor",[editor]);if(callback)callback.apply(editor,[element])},0)},null,null,9999)}else CKEDITOR.on("instanceReady",function(event){var editor=event.editor;setTimeout(function(){if(!editor.element){setTimeout(arguments.callee,100);return}if(editor.element.$==element)if(callback)callback.apply(editor,[element])},0)},null,null,9999)});return this}});
if(CKEDITOR.config.jqueryOverrideVal)jQuery.fn.val=CKEDITOR.tools.override(jQuery.fn.val,function(oldValMethod){return function(newValue,forceNative){var isSetter=typeof newValue!="undefined",result;this.each(function(){var $this=jQuery(this),editor=$this.data("ckeditorInstance");if(!forceNative&&$this.is("textarea")&&editor)if(isSetter)editor.setData(newValue);else{result=editor.getData();return null}else if(isSetter)oldValMethod.call($this,newValue);else{result=oldValMethod.call($this);return null}return true});
return isSetter?this:result}})})();