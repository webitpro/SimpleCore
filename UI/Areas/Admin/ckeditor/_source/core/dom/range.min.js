CKEDITOR.dom.range=function(document){this.startContainer=null;this.startOffset=null;this.endContainer=null;this.endOffset=null;this.collapsed=true;this.document=document};
(function(){var updateCollapsed=function(range){range.collapsed=range.startContainer&&range.endContainer&&range.startContainer.equals(range.endContainer)&&range.startOffset==range.endOffset};var execContentsAction=function(range,action,docFrag,mergeThen){range.optimizeBookmark();var startNode=range.startContainer;var endNode=range.endContainer;var startOffset=range.startOffset;var endOffset=range.endOffset;var removeStartNode;var removeEndNode;if(endNode.type==CKEDITOR.NODE_TEXT)endNode=endNode.split(endOffset);
else if(endNode.getChildCount()>0)if(endOffset>=endNode.getChildCount()){endNode=endNode.append(range.document.createText(""));removeEndNode=true}else endNode=endNode.getChild(endOffset);if(startNode.type==CKEDITOR.NODE_TEXT){startNode.split(startOffset);if(startNode.equals(endNode))endNode=startNode.getNext()}else if(!startOffset){startNode=startNode.getFirst().insertBeforeMe(range.document.createText(""));removeStartNode=true}else if(startOffset>=startNode.getChildCount()){startNode=startNode.append(range.document.createText(""));
removeStartNode=true}else startNode=startNode.getChild(startOffset).getPrevious();var startParents=startNode.getParents();var endParents=endNode.getParents();var i,topStart,topEnd;for(i=0;i<startParents.length;i++){topStart=startParents[i];topEnd=endParents[i];if(!topStart.equals(topEnd))break}var clone=docFrag,levelStartNode,levelClone,currentNode,currentSibling;for(var j=i;j<startParents.length;j++){levelStartNode=startParents[j];if(clone&&!levelStartNode.equals(startNode))levelClone=clone.append(levelStartNode.clone());
currentNode=levelStartNode.getNext();while(currentNode){if(currentNode.equals(endParents[j])||currentNode.equals(endNode))break;currentSibling=currentNode.getNext();if(action==2)clone.append(currentNode.clone(true));else{currentNode.remove();if(action==1)clone.append(currentNode)}currentNode=currentSibling}if(clone)clone=levelClone}clone=docFrag;for(var k=i;k<endParents.length;k++){levelStartNode=endParents[k];if(action>0&&!levelStartNode.equals(endNode))levelClone=clone.append(levelStartNode.clone());
if(!startParents[k]||levelStartNode.$.parentNode!=startParents[k].$.parentNode){currentNode=levelStartNode.getPrevious();while(currentNode){if(currentNode.equals(startParents[k])||currentNode.equals(startNode))break;currentSibling=currentNode.getPrevious();if(action==2)clone.$.insertBefore(currentNode.$.cloneNode(true),clone.$.firstChild);else{currentNode.remove();if(action==1)clone.$.insertBefore(currentNode.$,clone.$.firstChild)}currentNode=currentSibling}}if(clone)clone=levelClone}if(action==2){var startTextNode=
range.startContainer;if(startTextNode.type==CKEDITOR.NODE_TEXT){startTextNode.$.data+=startTextNode.$.nextSibling.data;startTextNode.$.parentNode.removeChild(startTextNode.$.nextSibling)}var endTextNode=range.endContainer;if(endTextNode.type==CKEDITOR.NODE_TEXT&&endTextNode.$.nextSibling){endTextNode.$.data+=endTextNode.$.nextSibling.data;endTextNode.$.parentNode.removeChild(endTextNode.$.nextSibling)}}else{if(topStart&&topEnd&&(startNode.$.parentNode!=topStart.$.parentNode||endNode.$.parentNode!=
topEnd.$.parentNode)){var endIndex=topEnd.getIndex();if(removeStartNode&&topEnd.$.parentNode==startNode.$.parentNode)endIndex--;if(mergeThen&&topStart.type==CKEDITOR.NODE_ELEMENT){var span=CKEDITOR.dom.element.createFromHtml("<span "+'data-cke-bookmark="1" style="display:none">&nbsp;</span>',range.document);span.insertAfter(topStart);topStart.mergeSiblings(false);range.moveToBookmark({startNode:span})}else range.setStart(topEnd.getParent(),endIndex)}range.collapse(true)}if(removeStartNode)startNode.remove();
if(removeEndNode&&endNode.$.parentNode)endNode.remove()};var inlineChildReqElements={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};function getCheckStartEndBlockEvalFunction(isStart){var hadBr=false,bookmarkEvaluator=CKEDITOR.dom.walker.bookmark(true);return function(node){if(bookmarkEvaluator(node))return true;if(node.type==CKEDITOR.NODE_TEXT){if(node.hasAscendant("pre")||CKEDITOR.tools.trim(node.getText()).length)return false}else if(node.type==
CKEDITOR.NODE_ELEMENT)if(!inlineChildReqElements[node.getName()])if(!isStart&&!CKEDITOR.env.ie&&node.getName()=="br"&&!hadBr)hadBr=true;else return false;return true}}function elementBoundaryEval(node){return node.type!=CKEDITOR.NODE_TEXT&&node.getName()in CKEDITOR.dtd.$removeEmpty||!CKEDITOR.tools.trim(node.getText())||!!node.getParent().data("cke-bookmark")}var whitespaceEval=new CKEDITOR.dom.walker.whitespaces,bookmarkEval=new CKEDITOR.dom.walker.bookmark;function nonWhitespaceOrBookmarkEval(node){return!whitespaceEval(node)&&
!bookmarkEval(node)}CKEDITOR.dom.range.prototype={clone:function(){var clone=new CKEDITOR.dom.range(this.document);clone.startContainer=this.startContainer;clone.startOffset=this.startOffset;clone.endContainer=this.endContainer;clone.endOffset=this.endOffset;clone.collapsed=this.collapsed;return clone},collapse:function(toStart){if(toStart){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=
true},cloneContents:function(){var docFrag=new CKEDITOR.dom.documentFragment(this.document);if(!this.collapsed)execContentsAction(this,2,docFrag);return docFrag},deleteContents:function(mergeThen){if(this.collapsed)return;execContentsAction(this,0,null,mergeThen)},extractContents:function(mergeThen){var docFrag=new CKEDITOR.dom.documentFragment(this.document);if(!this.collapsed)execContentsAction(this,1,docFrag,mergeThen);return docFrag},createBookmark:function(serializable){var startNode,endNode;
var baseId;var clone;var collapsed=this.collapsed;startNode=this.document.createElement("span");startNode.data("cke-bookmark",1);startNode.setStyle("display","none");startNode.setHtml("&nbsp;");if(serializable){baseId="cke_bm_"+CKEDITOR.tools.getNextNumber();startNode.setAttribute("id",baseId+"S")}if(!collapsed){endNode=startNode.clone();endNode.setHtml("&nbsp;");if(serializable)endNode.setAttribute("id",baseId+"E");clone=this.clone();clone.collapse();clone.insertNode(endNode)}clone=this.clone();
clone.collapse(true);clone.insertNode(startNode);if(endNode){this.setStartAfter(startNode);this.setEndBefore(endNode)}else this.moveToPosition(startNode,CKEDITOR.POSITION_AFTER_END);return{startNode:serializable?baseId+"S":startNode,endNode:serializable?baseId+"E":endNode,serializable:serializable,collapsed:collapsed}},createBookmark2:function(normalized){var startContainer=this.startContainer,endContainer=this.endContainer;var startOffset=this.startOffset,endOffset=this.endOffset;var collapsed=this.collapsed;
var child,previous;if(!startContainer||!endContainer)return{start:0,end:0};if(normalized){if(startContainer.type==CKEDITOR.NODE_ELEMENT){child=startContainer.getChild(startOffset);if(child&&child.type==CKEDITOR.NODE_TEXT&&startOffset>0&&child.getPrevious().type==CKEDITOR.NODE_TEXT){startContainer=child;startOffset=0}if(child&&child.type==CKEDITOR.NODE_ELEMENT)startOffset=child.getIndex(1)}while(startContainer.type==CKEDITOR.NODE_TEXT&&(previous=startContainer.getPrevious())&&previous.type==CKEDITOR.NODE_TEXT){startContainer=
previous;startOffset+=previous.getLength()}if(!collapsed){if(endContainer.type==CKEDITOR.NODE_ELEMENT){child=endContainer.getChild(endOffset);if(child&&child.type==CKEDITOR.NODE_TEXT&&endOffset>0&&child.getPrevious().type==CKEDITOR.NODE_TEXT){endContainer=child;endOffset=0}if(child&&child.type==CKEDITOR.NODE_ELEMENT)endOffset=child.getIndex(1)}while(endContainer.type==CKEDITOR.NODE_TEXT&&(previous=endContainer.getPrevious())&&previous.type==CKEDITOR.NODE_TEXT){endContainer=previous;endOffset+=previous.getLength()}}}return{start:startContainer.getAddress(normalized),
end:collapsed?null:endContainer.getAddress(normalized),startOffset:startOffset,endOffset:endOffset,normalized:normalized,collapsed:collapsed,is2:true}},moveToBookmark:function(bookmark){if(bookmark.is2){var startContainer=this.document.getByAddress(bookmark.start,bookmark.normalized),startOffset=bookmark.startOffset;var endContainer=bookmark.end&&this.document.getByAddress(bookmark.end,bookmark.normalized),endOffset=bookmark.endOffset;this.setStart(startContainer,startOffset);if(endContainer)this.setEnd(endContainer,
endOffset);else this.collapse(true)}else{var serializable=bookmark.serializable,startNode=serializable?this.document.getById(bookmark.startNode):bookmark.startNode,endNode=serializable?this.document.getById(bookmark.endNode):bookmark.endNode;this.setStartBefore(startNode);startNode.remove();if(endNode){this.setEndBefore(endNode);endNode.remove()}else this.collapse(true)}},getBoundaryNodes:function(){var startNode=this.startContainer,endNode=this.endContainer,startOffset=this.startOffset,endOffset=
this.endOffset,childCount;if(startNode.type==CKEDITOR.NODE_ELEMENT){childCount=startNode.getChildCount();if(childCount>startOffset)startNode=startNode.getChild(startOffset);else if(childCount<1)startNode=startNode.getPreviousSourceNode();else{startNode=startNode.$;while(startNode.lastChild)startNode=startNode.lastChild;startNode=new CKEDITOR.dom.node(startNode);startNode=startNode.getNextSourceNode()||startNode}}if(endNode.type==CKEDITOR.NODE_ELEMENT){childCount=endNode.getChildCount();if(childCount>
endOffset)endNode=endNode.getChild(endOffset).getPreviousSourceNode(true);else if(childCount<1)endNode=endNode.getPreviousSourceNode();else{endNode=endNode.$;while(endNode.lastChild)endNode=endNode.lastChild;endNode=new CKEDITOR.dom.node(endNode)}}if(startNode.getPosition(endNode)&CKEDITOR.POSITION_FOLLOWING)startNode=endNode;return{startNode:startNode,endNode:endNode}},getCommonAncestor:function(includeSelf,ignoreTextNode){var start=this.startContainer,end=this.endContainer,ancestor;if(start.equals(end))if(includeSelf&&
start.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1)ancestor=start.getChild(this.startOffset);else ancestor=start;else ancestor=start.getCommonAncestor(end);return ignoreTextNode&&!ancestor.is?ancestor.getParent():ancestor},optimize:function(){var container=this.startContainer;var offset=this.startOffset;if(container.type!=CKEDITOR.NODE_ELEMENT)if(!offset)this.setStartBefore(container);else if(offset>=container.getLength())this.setStartAfter(container);container=this.endContainer;
offset=this.endOffset;if(container.type!=CKEDITOR.NODE_ELEMENT)if(!offset)this.setEndBefore(container);else if(offset>=container.getLength())this.setEndAfter(container)},optimizeBookmark:function(){var startNode=this.startContainer,endNode=this.endContainer;if(startNode.is&&startNode.is("span")&&startNode.data("cke-bookmark"))this.setStartAt(startNode,CKEDITOR.POSITION_BEFORE_START);if(endNode&&endNode.is&&endNode.is("span")&&endNode.data("cke-bookmark"))this.setEndAt(endNode,CKEDITOR.POSITION_AFTER_END)},
trim:function(ignoreStart,ignoreEnd){var startContainer=this.startContainer,startOffset=this.startOffset,collapsed=this.collapsed;if((!ignoreStart||collapsed)&&startContainer&&startContainer.type==CKEDITOR.NODE_TEXT){if(!startOffset){startOffset=startContainer.getIndex();startContainer=startContainer.getParent()}else if(startOffset>=startContainer.getLength()){startOffset=startContainer.getIndex()+1;startContainer=startContainer.getParent()}else{var nextText=startContainer.split(startOffset);startOffset=
startContainer.getIndex()+1;startContainer=startContainer.getParent();if(this.startContainer.equals(this.endContainer))this.setEnd(nextText,this.endOffset-this.startOffset);else if(startContainer.equals(this.endContainer))this.endOffset+=1}this.setStart(startContainer,startOffset);if(collapsed){this.collapse(true);return}}var endContainer=this.endContainer;var endOffset=this.endOffset;if(!(ignoreEnd||collapsed)&&endContainer&&endContainer.type==CKEDITOR.NODE_TEXT){if(!endOffset){endOffset=endContainer.getIndex();
endContainer=endContainer.getParent()}else if(endOffset>=endContainer.getLength()){endOffset=endContainer.getIndex()+1;endContainer=endContainer.getParent()}else{endContainer.split(endOffset);endOffset=endContainer.getIndex()+1;endContainer=endContainer.getParent()}this.setEnd(endContainer,endOffset)}},enlarge:function(unit,excludeBrs){switch(unit){case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)return;var commonAncestor=this.getCommonAncestor();var body=this.document.getBody();var startTop,endTop;
var enlargeable,sibling,commonReached;var needsWhiteSpace=false;var isWhiteSpace;var siblingText;var container=this.startContainer;var offset=this.startOffset;if(container.type==CKEDITOR.NODE_TEXT){if(offset){container=!CKEDITOR.tools.trim(container.substring(0,offset)).length&&container;needsWhiteSpace=!!container}if(container)if(!(sibling=container.getPrevious()))enlargeable=container.getParent()}else{if(offset)sibling=container.getChild(offset-1)||container.getLast();if(!sibling)enlargeable=container}while(enlargeable||
sibling){if(enlargeable&&!sibling){if(!commonReached&&enlargeable.equals(commonAncestor))commonReached=true;if(!body.contains(enlargeable))break;if(!needsWhiteSpace||enlargeable.getComputedStyle("display")!="inline"){needsWhiteSpace=false;if(commonReached)startTop=enlargeable;else this.setStartBefore(enlargeable)}sibling=enlargeable.getPrevious()}while(sibling){isWhiteSpace=false;if(sibling.type==CKEDITOR.NODE_TEXT){siblingText=sibling.getText();if(/[^\s\ufeff]/.test(siblingText))sibling=null;isWhiteSpace=
/[\s\ufeff]$/.test(siblingText)}else if((sibling.$.offsetWidth>0||excludeBrs&&sibling.is("br"))&&!sibling.data("cke-bookmark"))if(needsWhiteSpace&&CKEDITOR.dtd.$removeEmpty[sibling.getName()]){siblingText=sibling.getText();if(/[^\s\ufeff]/.test(siblingText))sibling=null;else{var allChildren=sibling.$.all||sibling.$.getElementsByTagName("*");for(var i=0,child;child=allChildren[i++];)if(!CKEDITOR.dtd.$removeEmpty[child.nodeName.toLowerCase()]){sibling=null;break}}if(sibling)isWhiteSpace=!!siblingText.length}else sibling=
null;if(isWhiteSpace)if(needsWhiteSpace)if(commonReached)startTop=enlargeable;else{if(enlargeable)this.setStartBefore(enlargeable)}else needsWhiteSpace=true;if(sibling){var next=sibling.getPrevious();if(!enlargeable&&!next){enlargeable=sibling;sibling=null;break}sibling=next}else enlargeable=null}if(enlargeable)enlargeable=enlargeable.getParent()}container=this.endContainer;offset=this.endOffset;enlargeable=sibling=null;commonReached=needsWhiteSpace=false;if(container.type==CKEDITOR.NODE_TEXT){container=
!CKEDITOR.tools.trim(container.substring(offset)).length&&container;needsWhiteSpace=!(container&&container.getLength());if(container)if(!(sibling=container.getNext()))enlargeable=container.getParent()}else{sibling=container.getChild(offset);if(!sibling)enlargeable=container}while(enlargeable||sibling){if(enlargeable&&!sibling){if(!commonReached&&enlargeable.equals(commonAncestor))commonReached=true;if(!body.contains(enlargeable))break;if(!needsWhiteSpace||enlargeable.getComputedStyle("display")!=
"inline"){needsWhiteSpace=false;if(commonReached)endTop=enlargeable;else if(enlargeable)this.setEndAfter(enlargeable)}sibling=enlargeable.getNext()}while(sibling){isWhiteSpace=false;if(sibling.type==CKEDITOR.NODE_TEXT){siblingText=sibling.getText();if(/[^\s\ufeff]/.test(siblingText))sibling=null;isWhiteSpace=/^[\s\ufeff]/.test(siblingText)}else if((sibling.$.offsetWidth>0||excludeBrs&&sibling.is("br"))&&!sibling.data("cke-bookmark"))if(needsWhiteSpace&&CKEDITOR.dtd.$removeEmpty[sibling.getName()]){siblingText=
sibling.getText();if(/[^\s\ufeff]/.test(siblingText))sibling=null;else{allChildren=sibling.$.all||sibling.$.getElementsByTagName("*");for(i=0;child=allChildren[i++];)if(!CKEDITOR.dtd.$removeEmpty[child.nodeName.toLowerCase()]){sibling=null;break}}if(sibling)isWhiteSpace=!!siblingText.length}else sibling=null;if(isWhiteSpace)if(needsWhiteSpace)if(commonReached)endTop=enlargeable;else this.setEndAfter(enlargeable);if(sibling){next=sibling.getNext();if(!enlargeable&&!next){enlargeable=sibling;sibling=
null;break}sibling=next}else enlargeable=null}if(enlargeable)enlargeable=enlargeable.getParent()}if(startTop&&endTop){commonAncestor=startTop.contains(endTop)?endTop:startTop;this.setStartBefore(commonAncestor);this.setEndAfter(commonAncestor)}break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:var walkerRange=new CKEDITOR.dom.range(this.document);body=this.document.getBody();walkerRange.setStartAt(body,CKEDITOR.POSITION_AFTER_START);walkerRange.setEnd(this.startContainer,
this.startOffset);var walker=new CKEDITOR.dom.walker(walkerRange),blockBoundary,tailBr,notBlockBoundary=CKEDITOR.dom.walker.blockBoundary(unit==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),boundaryGuard=function(node){var retval=notBlockBoundary(node);if(!retval)blockBoundary=node;return retval},tailBrGuard=function(node){var retval=boundaryGuard(node);if(!retval&&node.is&&node.is("br"))tailBr=node;return retval};walker.guard=boundaryGuard;enlargeable=walker.lastBackward();blockBoundary=blockBoundary||
body;this.setStartAt(blockBoundary,!blockBoundary.is("br")&&(!enlargeable&&this.checkStartOfBlock()||enlargeable&&blockBoundary.contains(enlargeable))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END);if(unit==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){var theRange=this.clone();walker=new CKEDITOR.dom.walker(theRange);var whitespaces=CKEDITOR.dom.walker.whitespaces(),bookmark=CKEDITOR.dom.walker.bookmark();walker.evaluator=function(node){return!whitespaces(node)&&!bookmark(node)};var previous=
walker.previous();if(previous&&previous.type==CKEDITOR.NODE_ELEMENT&&previous.is("br"))return}walkerRange=this.clone();walkerRange.collapse();walkerRange.setEndAt(body,CKEDITOR.POSITION_BEFORE_END);walker=new CKEDITOR.dom.walker(walkerRange);walker.guard=unit==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?tailBrGuard:boundaryGuard;blockBoundary=null;enlargeable=walker.lastForward();blockBoundary=blockBoundary||body;this.setEndAt(blockBoundary,!enlargeable&&this.checkEndOfBlock()||enlargeable&&blockBoundary.contains(enlargeable)?
CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START);if(tailBr)this.setEndAfter(tailBr)}},shrink:function(mode,selectContents){if(!this.collapsed){mode=mode||CKEDITOR.SHRINK_TEXT;var walkerRange=this.clone();var startContainer=this.startContainer,endContainer=this.endContainer,startOffset=this.startOffset,endOffset=this.endOffset,collapsed=this.collapsed;var moveStart=1,moveEnd=1;if(startContainer&&startContainer.type==CKEDITOR.NODE_TEXT)if(!startOffset)walkerRange.setStartBefore(startContainer);
else if(startOffset>=startContainer.getLength())walkerRange.setStartAfter(startContainer);else{walkerRange.setStartBefore(startContainer);moveStart=0}if(endContainer&&endContainer.type==CKEDITOR.NODE_TEXT)if(!endOffset)walkerRange.setEndBefore(endContainer);else if(endOffset>=endContainer.getLength())walkerRange.setEndAfter(endContainer);else{walkerRange.setEndAfter(endContainer);moveEnd=0}var walker=new CKEDITOR.dom.walker(walkerRange),isBookmark=CKEDITOR.dom.walker.bookmark();walker.evaluator=function(node){return node.type==
(mode==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var currentElement;walker.guard=function(node,movingOut){if(isBookmark(node))return true;if(mode==CKEDITOR.SHRINK_ELEMENT&&node.type==CKEDITOR.NODE_TEXT)return false;if(movingOut&&node.equals(currentElement))return false;if(!movingOut&&node.type==CKEDITOR.NODE_ELEMENT)currentElement=node;return true};if(moveStart){var textStart=walker[mode==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]();textStart&&this.setStartAt(textStart,
selectContents?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START)}if(moveEnd){walker.reset();var textEnd=walker[mode==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]();textEnd&&this.setEndAt(textEnd,selectContents?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)}return!!(moveStart||moveEnd)}},insertNode:function(node){this.optimizeBookmark();this.trim(false,true);var startContainer=this.startContainer;var startOffset=this.startOffset;var nextNode=startContainer.getChild(startOffset);
if(nextNode)node.insertBefore(nextNode);else startContainer.append(node);if(node.getParent().equals(this.endContainer))this.endOffset++;this.setStartBefore(node)},moveToPosition:function(node,position){this.setStartAt(node,position);this.collapse(true)},selectNodeContents:function(node){this.setStart(node,0);this.setEnd(node,node.type==CKEDITOR.NODE_TEXT?node.getLength():node.getChildCount())},setStart:function(startNode,startOffset){if(startNode.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[startNode.getName()])startOffset=
startNode.getIndex(),startNode=startNode.getParent();this.startContainer=startNode;this.startOffset=startOffset;if(!this.endContainer){this.endContainer=startNode;this.endOffset=startOffset}updateCollapsed(this)},setEnd:function(endNode,endOffset){if(endNode.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[endNode.getName()])endOffset=endNode.getIndex()+1,endNode=endNode.getParent();this.endContainer=endNode;this.endOffset=endOffset;if(!this.startContainer){this.startContainer=endNode;this.startOffset=
endOffset}updateCollapsed(this)},setStartAfter:function(node){this.setStart(node.getParent(),node.getIndex()+1)},setStartBefore:function(node){this.setStart(node.getParent(),node.getIndex())},setEndAfter:function(node){this.setEnd(node.getParent(),node.getIndex()+1)},setEndBefore:function(node){this.setEnd(node.getParent(),node.getIndex())},setStartAt:function(node,position){switch(position){case CKEDITOR.POSITION_AFTER_START:this.setStart(node,0);break;case CKEDITOR.POSITION_BEFORE_END:if(node.type==
CKEDITOR.NODE_TEXT)this.setStart(node,node.getLength());else this.setStart(node,node.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(node);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(node)}updateCollapsed(this)},setEndAt:function(node,position){switch(position){case CKEDITOR.POSITION_AFTER_START:this.setEnd(node,0);break;case CKEDITOR.POSITION_BEFORE_END:if(node.type==CKEDITOR.NODE_TEXT)this.setEnd(node,node.getLength());else this.setEnd(node,node.getChildCount());
break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(node);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(node)}updateCollapsed(this)},fixBlock:function(isStart,blockTag){var bookmark=this.createBookmark(),fixedBlock=this.document.createElement(blockTag);this.collapse(isStart);this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS);this.extractContents().appendTo(fixedBlock);fixedBlock.trim();if(!CKEDITOR.env.ie)fixedBlock.appendBogus();this.insertNode(fixedBlock);this.moveToBookmark(bookmark);
return fixedBlock},splitBlock:function(blockTag){var startPath=new CKEDITOR.dom.elementPath(this.startContainer),endPath=new CKEDITOR.dom.elementPath(this.endContainer);var startBlockLimit=startPath.blockLimit,endBlockLimit=endPath.blockLimit;var startBlock=startPath.block,endBlock=endPath.block;var elementPath=null;if(!startBlockLimit.equals(endBlockLimit))return null;if(blockTag!="br"){if(!startBlock){startBlock=this.fixBlock(true,blockTag);endBlock=(new CKEDITOR.dom.elementPath(this.endContainer)).block}if(!endBlock)endBlock=
this.fixBlock(false,blockTag)}var isStartOfBlock=startBlock&&this.checkStartOfBlock(),isEndOfBlock=endBlock&&this.checkEndOfBlock();this.deleteContents();if(startBlock&&startBlock.equals(endBlock))if(isEndOfBlock){elementPath=new CKEDITOR.dom.elementPath(this.startContainer);this.moveToPosition(endBlock,CKEDITOR.POSITION_AFTER_END);endBlock=null}else if(isStartOfBlock){elementPath=new CKEDITOR.dom.elementPath(this.startContainer);this.moveToPosition(startBlock,CKEDITOR.POSITION_BEFORE_START);startBlock=
null}else{endBlock=this.splitElement(startBlock);if(!CKEDITOR.env.ie&&!startBlock.is("ul","ol"))startBlock.appendBogus()}return{previousBlock:startBlock,nextBlock:endBlock,wasStartOfBlock:isStartOfBlock,wasEndOfBlock:isEndOfBlock,elementPath:elementPath}},splitElement:function(toSplit){if(!this.collapsed)return null;this.setEndAt(toSplit,CKEDITOR.POSITION_BEFORE_END);var documentFragment=this.extractContents();var clone=toSplit.clone(false);documentFragment.appendTo(clone);clone.insertAfter(toSplit);
this.moveToPosition(toSplit,CKEDITOR.POSITION_AFTER_END);return clone},checkBoundaryOfElement:function(element,checkType){var checkStart=checkType==CKEDITOR.START;var walkerRange=this.clone();walkerRange.collapse(checkStart);walkerRange[checkStart?"setStartAt":"setEndAt"](element,checkStart?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END);var walker=new CKEDITOR.dom.walker(walkerRange);walker.evaluator=elementBoundaryEval;return walker[checkStart?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var startContainer=
this.startContainer,startOffset=this.startOffset;if(startOffset&&startContainer.type==CKEDITOR.NODE_TEXT){var textBefore=CKEDITOR.tools.ltrim(startContainer.substring(0,startOffset));if(textBefore.length)return false}this.trim();var path=new CKEDITOR.dom.elementPath(this.startContainer);var walkerRange=this.clone();walkerRange.collapse(true);walkerRange.setStartAt(path.block||path.blockLimit,CKEDITOR.POSITION_AFTER_START);var walker=new CKEDITOR.dom.walker(walkerRange);walker.evaluator=getCheckStartEndBlockEvalFunction(true);
return walker.checkBackward()},checkEndOfBlock:function(){var endContainer=this.endContainer,endOffset=this.endOffset;if(endContainer.type==CKEDITOR.NODE_TEXT){var textAfter=CKEDITOR.tools.rtrim(endContainer.substring(endOffset));if(textAfter.length)return false}this.trim();var path=new CKEDITOR.dom.elementPath(this.endContainer);var walkerRange=this.clone();walkerRange.collapse(false);walkerRange.setEndAt(path.block||path.blockLimit,CKEDITOR.POSITION_BEFORE_END);var walker=new CKEDITOR.dom.walker(walkerRange);
walker.evaluator=getCheckStartEndBlockEvalFunction(false);return walker.checkForward()},checkReadOnly:function(){function checkNodesEditable(node,anotherEnd){while(node){if(node.type==CKEDITOR.NODE_ELEMENT)if(node.getAttribute("contentEditable")=="false"&&!node.data("cke-editable"))return 0;else if(node.is("html")||node.getAttribute("contentEditable")=="true"&&(node.contains(anotherEnd)||node.equals(anotherEnd)))break;node=node.getParent()}return 1}return function(){var startNode=this.startContainer,
endNode=this.endContainer;return!(checkNodesEditable(startNode,endNode)&&checkNodesEditable(endNode,startNode))}}(),moveToElementEditablePosition:function(el,isMoveToEnd){function nextDFS(node,childOnly){var next;if(node.type==CKEDITOR.NODE_ELEMENT&&node.isEditable(false)&&!CKEDITOR.dtd.$nonEditable[node.getName()])next=node[isMoveToEnd?"getLast":"getFirst"](nonWhitespaceOrBookmarkEval);if(!childOnly&&!next)next=node[isMoveToEnd?"getPrevious":"getNext"](nonWhitespaceOrBookmarkEval);return next}var found=
0;while(el){if(el.type==CKEDITOR.NODE_TEXT){this.moveToPosition(el,isMoveToEnd?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START);found=1;break}if(el.type==CKEDITOR.NODE_ELEMENT)if(el.isEditable()){this.moveToPosition(el,isMoveToEnd?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START);found=1}el=nextDFS(el,found)}return!!found},moveToElementEditStart:function(target){return this.moveToElementEditablePosition(target)},moveToElementEditEnd:function(target){return this.moveToElementEditablePosition(target,
true)},getEnclosedNode:function(){var walkerRange=this.clone();walkerRange.optimize();if(walkerRange.startContainer.type!=CKEDITOR.NODE_ELEMENT||walkerRange.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var walker=new CKEDITOR.dom.walker(walkerRange),isNotBookmarks=CKEDITOR.dom.walker.bookmark(true),isNotWhitespaces=CKEDITOR.dom.walker.whitespaces(true),evaluator=function(node){return isNotWhitespaces(node)&&isNotBookmarks(node)};walkerRange.evaluator=evaluator;var node=walker.next();walker.reset();
return node&&node.equals(walker.previous())?node:null},getTouchedStartNode:function(){var container=this.startContainer;if(this.collapsed||container.type!=CKEDITOR.NODE_ELEMENT)return container;return container.getChild(this.startOffset)||container},getTouchedEndNode:function(){var container=this.endContainer;if(this.collapsed||container.type!=CKEDITOR.NODE_ELEMENT)return container;return container.getChild(this.endOffset-1)||container}}})();CKEDITOR.POSITION_AFTER_START=1;
CKEDITOR.POSITION_BEFORE_END=2;CKEDITOR.POSITION_BEFORE_START=3;CKEDITOR.POSITION_AFTER_END=4;CKEDITOR.ENLARGE_ELEMENT=1;CKEDITOR.ENLARGE_BLOCK_CONTENTS=2;CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3;CKEDITOR.START=1;CKEDITOR.END=2;CKEDITOR.STARTEND=3;CKEDITOR.SHRINK_ELEMENT=1;CKEDITOR.SHRINK_TEXT=2;