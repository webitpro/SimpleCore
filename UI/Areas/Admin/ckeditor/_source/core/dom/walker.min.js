(function(){function iterate(rtl,breakOnFalse){if(this._.end)return null;var node,range=this.range,guard,userGuard=this.guard,type=this.type,getSourceNodeFn=rtl?"getPreviousSourceNode":"getNextSourceNode";if(!this._.start){this._.start=1;range.trim();if(range.collapsed){this.end();return null}}if(!rtl&&!this._.guardLTR){var limitLTR=range.endContainer,blockerLTR=limitLTR.getChild(range.endOffset);this._.guardLTR=function(node,movingOut){return(!movingOut||!limitLTR.equals(node))&&(!blockerLTR||!node.equals(blockerLTR))&&
(node.type!=CKEDITOR.NODE_ELEMENT||!movingOut||node.getName()!="body")}}if(rtl&&!this._.guardRTL){var limitRTL=range.startContainer,blockerRTL=range.startOffset>0&&limitRTL.getChild(range.startOffset-1);this._.guardRTL=function(node,movingOut){return(!movingOut||!limitRTL.equals(node))&&(!blockerRTL||!node.equals(blockerRTL))&&(node.type!=CKEDITOR.NODE_ELEMENT||!movingOut||node.getName()!="body")}}var stopGuard=rtl?this._.guardRTL:this._.guardLTR;if(userGuard)guard=function(node,movingOut){if(stopGuard(node,
movingOut)===false)return false;return userGuard(node,movingOut)};else guard=stopGuard;if(this.current)node=this.current[getSourceNodeFn](false,type,guard);else if(rtl){node=range.endContainer;if(range.endOffset>0){node=node.getChild(range.endOffset-1);if(guard(node)===false)node=null}else node=guard(node,true)===false?null:node.getPreviousSourceNode(true,type,guard)}else{node=range.startContainer;node=node.getChild(range.startOffset);if(node){if(guard(node)===false)node=null}else node=guard(range.startContainer,
true)===false?null:range.startContainer.getNextSourceNode(true,type,guard)}while(node&&!this._.end){this.current=node;if(!this.evaluator||this.evaluator(node)!==false){if(!breakOnFalse)return node}else if(breakOnFalse&&this.evaluator)return false;node=node[getSourceNodeFn](false,type,guard)}this.end();return this.current=null}function iterateToLast(rtl){var node,last=null;while(node=iterate.call(this,rtl))last=node;return last}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(range){this.range=
range;this._={}},proto:{end:function(){this._.end=1},next:function(){return iterate.call(this)},previous:function(){return iterate.call(this,1)},checkForward:function(){return iterate.call(this,0,1)!==false},checkBackward:function(){return iterate.call(this,1,1)!==false},lastForward:function(){return iterateToLast.call(this)},lastBackward:function(){return iterateToLast.call(this,1)},reset:function(){delete this.current;this._={}}}});var blockBoundaryDisplayMatch={block:1,"list-item":1,table:1,"table-row-group":1,
"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(customNodeNames){var nodeNameMatches=customNodeNames?CKEDITOR.tools.extend({},CKEDITOR.dtd.$block,customNodeNames||{}):CKEDITOR.dtd.$block;return this.getComputedStyle("float")=="none"&&blockBoundaryDisplayMatch[this.getComputedStyle("display")]||nodeNameMatches[this.getName()]};CKEDITOR.dom.walker.blockBoundary=
function(customNodeNames){return function(node,type){return!(node.type==CKEDITOR.NODE_ELEMENT&&node.isBlockBoundary(customNodeNames))}};CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})};CKEDITOR.dom.walker.bookmark=function(contentOnly,isReject){function isBookmarkNode(node){return node&&node.getName&&node.getName()=="span"&&node.data("cke-bookmark")}return function(node){var isBookmark,parent;isBookmark=node&&!node.getName&&(parent=node.getParent())&&isBookmarkNode(parent);
isBookmark=contentOnly?isBookmark:isBookmark||isBookmarkNode(node);return!!(isReject^isBookmark)}};CKEDITOR.dom.walker.whitespaces=function(isReject){return function(node){var isWhitespace=node&&node.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(node.getText());return!!(isReject^isWhitespace)}};CKEDITOR.dom.walker.invisible=function(isReject){var whitespace=CKEDITOR.dom.walker.whitespaces();return function(node){var isInvisible=whitespace(node)||node.is&&!node.$.offsetHeight;return!!(isReject^isInvisible)}};
CKEDITOR.dom.walker.nodeType=function(type,isReject){return function(node){return!!(isReject^node.type==type)}};var tailNbspRegex=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,isWhitespaces=CKEDITOR.dom.walker.whitespaces(),isBookmark=CKEDITOR.dom.walker.bookmark(),toSkip=function(node){return isBookmark(node)||isWhitespaces(node)||node.type==CKEDITOR.NODE_ELEMENT&&node.getName()in CKEDITOR.dtd.$inline&&!(node.getName()in CKEDITOR.dtd.$empty)};CKEDITOR.dom.element.prototype.getBogus=function(){var tail=this;do tail=
tail.getPreviousSourceNode();while(toSkip(tail));if(tail&&(!CKEDITOR.env.ie?tail.is&&tail.is("br"):tail.getText&&tailNbspRegex.test(tail.getText())))return tail;return false}})();