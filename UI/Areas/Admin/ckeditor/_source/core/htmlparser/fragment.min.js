CKEDITOR.htmlParser.fragment=function(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false}};
(function(){var nonBreakingBlocks=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl);var optionalCloseTags=CKEDITOR.env.ie&&CKEDITOR.env.version<8?{dd:1,dt:1}:{};var listBlocks={ol:1,ul:1};var rootDtd=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1});function isRemoveEmpty(node){return node.name=="a"&&node.attributes.href||CKEDITOR.dtd.$removeEmpty[node.name]}CKEDITOR.htmlParser.fragment.fromHtml=
function(fragmentHtml,fixForBody,contextNode){var parser=new CKEDITOR.htmlParser,fragment=contextNode||new CKEDITOR.htmlParser.fragment,pendingInline=[],pendingBRs=[],currentNode=fragment,inTextarea=false,inPre=false;function checkPending(newTagName){var pendingBRsSent;if(pendingInline.length>0)for(var i=0;i<pendingInline.length;i++){var pendingElement=pendingInline[i],pendingName=pendingElement.name,pendingDtd=CKEDITOR.dtd[pendingName],currentDtd=currentNode.name&&CKEDITOR.dtd[currentNode.name];
if((!currentDtd||currentDtd[pendingName])&&(!newTagName||!pendingDtd||pendingDtd[newTagName]||!CKEDITOR.dtd[newTagName])){if(!pendingBRsSent){sendPendingBRs();pendingBRsSent=1}pendingElement=pendingElement.clone();pendingElement.parent=currentNode;currentNode=pendingElement;pendingInline.splice(i,1);i--}else if(pendingName==currentNode.name)addElement(currentNode,currentNode.parent,1),i--}}function sendPendingBRs(){while(pendingBRs.length)currentNode.add(pendingBRs.shift())}function addElement(element,
target,moveCurrent){if(element.previous!==undefined)return;target=target||currentNode||fragment;var savedCurrent=currentNode;if(fixForBody&&(!target.type||target.name=="body")){var elementName,realElementName;if(element.attributes&&(realElementName=element.attributes["data-cke-real-element-type"]))elementName=realElementName;else elementName=element.name;if(elementName&&!(elementName in CKEDITOR.dtd.$body||elementName=="body"||element.isOrphan)){currentNode=target;parser.onTagOpen(fixForBody,{});
element.returnPoint=target=currentNode}}if(element._.isBlockLike&&element.name!="pre"&&element.name!="textarea"){var length=element.children.length,lastChild=element.children[length-1],text;if(lastChild&&lastChild.type==CKEDITOR.NODE_TEXT)if(!(text=CKEDITOR.tools.rtrim(lastChild.value)))element.children.length=length-1;else lastChild.value=text}target.add(element);if(element.returnPoint){currentNode=element.returnPoint;delete element.returnPoint}else currentNode=moveCurrent?target:savedCurrent}parser.onTagOpen=
function(tagName,attributes,selfClosing,optionalClose){var element=new CKEDITOR.htmlParser.element(tagName,attributes);if(element.isUnknown&&selfClosing)element.isEmpty=true;element.isOptionalClose=tagName in optionalCloseTags||optionalClose;if(isRemoveEmpty(element)){pendingInline.push(element);return}else if(tagName=="pre")inPre=true;else if(tagName=="br"&&inPre){currentNode.add(new CKEDITOR.htmlParser.text("\n"));return}else if(tagName=="textarea")inTextarea=true;if(tagName=="br"){pendingBRs.push(element);
return}while(1){var currentName=currentNode.name;var currentDtd=currentName?CKEDITOR.dtd[currentName]||(currentNode._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):rootDtd;if(!element.isUnknown&&!currentNode.isUnknown&&!currentDtd[tagName])if(currentNode.isOptionalClose)parser.onTagClose(currentName);else if(tagName in listBlocks&&currentName in listBlocks){var children=currentNode.children,lastChild=children[children.length-1];if(!(lastChild&&lastChild.name=="li"))addElement(lastChild=new CKEDITOR.htmlParser.element("li"),
currentNode);!element.returnPoint&&(element.returnPoint=currentNode);currentNode=lastChild}else if(tagName in CKEDITOR.dtd.$listItem&&currentName!=tagName)parser.onTagOpen(tagName=="li"?"ul":"dl",{},0,1);else if(currentName in nonBreakingBlocks&&currentName!=tagName){!element.returnPoint&&(element.returnPoint=currentNode);currentNode=currentNode.parent}else{if(currentName in CKEDITOR.dtd.$inline)pendingInline.unshift(currentNode);if(currentNode.parent)addElement(currentNode,currentNode.parent,1);
else{element.isOrphan=1;break}}else break}checkPending(tagName);sendPendingBRs();element.parent=currentNode;if(element.isEmpty)addElement(element);else currentNode=element};parser.onTagClose=function(tagName){for(var i=pendingInline.length-1;i>=0;i--)if(tagName==pendingInline[i].name){pendingInline.splice(i,1);return}var pendingAdd=[],newPendingInline=[],candidate=currentNode;while(candidate!=fragment&&candidate.name!=tagName){if(!candidate._.isBlockLike)newPendingInline.unshift(candidate);pendingAdd.push(candidate);
candidate=candidate.returnPoint||candidate.parent}if(candidate!=fragment){for(i=0;i<pendingAdd.length;i++){var node=pendingAdd[i];addElement(node,node.parent)}currentNode=candidate;if(currentNode.name=="pre")inPre=false;if(currentNode.name=="textarea")inTextarea=false;if(candidate._.isBlockLike)sendPendingBRs();addElement(candidate,candidate.parent);if(candidate==currentNode)currentNode=currentNode.parent;pendingInline=pendingInline.concat(newPendingInline)}if(tagName=="body")fixForBody=false};parser.onText=
function(text){if((!currentNode._.hasInlineStarted||pendingBRs.length)&&!inPre&&!inTextarea){text=CKEDITOR.tools.ltrim(text);if(text.length===0)return}sendPendingBRs();checkPending();if(fixForBody&&(!currentNode.type||currentNode.name=="body")&&CKEDITOR.tools.trim(text))this.onTagOpen(fixForBody,{},0,1);if(!inPre&&!inTextarea)text=text.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ");currentNode.add(new CKEDITOR.htmlParser.text(text))};parser.onCDATA=function(cdata){currentNode.add(new CKEDITOR.htmlParser.cdata(cdata))};
parser.onComment=function(comment){sendPendingBRs();checkPending();currentNode.add(new CKEDITOR.htmlParser.comment(comment))};parser.parse(fragmentHtml);sendPendingBRs(!CKEDITOR.env.ie&&1);while(currentNode!=fragment)addElement(currentNode,currentNode.parent,1);return fragment};CKEDITOR.htmlParser.fragment.prototype={add:function(node,index){isNaN(index)&&(index=this.children.length);var previous=index>0?this.children[index-1]:null;if(previous){if(node._.isBlockLike&&previous.type==CKEDITOR.NODE_TEXT){previous.value=
CKEDITOR.tools.rtrim(previous.value);if(previous.value.length===0){this.children.pop();this.add(node);return}}previous.next=node}node.previous=previous;node.parent=this;this.children.splice(index,0,node);this._.hasInlineStarted=node.type==CKEDITOR.NODE_TEXT||node.type==CKEDITOR.NODE_ELEMENT&&!node._.isBlockLike},writeHtml:function(writer,filter){var isChildrenFiltered;this.filterChildren=function(){var writer=new CKEDITOR.htmlParser.basicWriter;this.writeChildrenHtml.call(this,writer,filter,true);
var html=writer.getHtml();this.children=(new CKEDITOR.htmlParser.fragment.fromHtml(html)).children;isChildrenFiltered=1};!this.name&&filter&&filter.onFragment(this);this.writeChildrenHtml(writer,isChildrenFiltered?null:filter)},writeChildrenHtml:function(writer,filter){for(var i=0;i<this.children.length;i++)this.children[i].writeHtml(writer,filter)}}})();